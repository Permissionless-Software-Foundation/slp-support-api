# slp-support-api

[![js-standard-style](https://img.shields.io/badge/code%20style-standard-brightgreen.svg)](http://standardjs.com) [![semantic-release](https://img.shields.io/badge/%20%20%F0%9F%93%A6%F0%9F%9A%80-semantic--release-e10079.svg)](https://github.com/semantic-release/semantic-release)

## Deprecation Notice

This code is deprecated and abandoned. Ultimately the approach didn't work.

This code attempted to do the block processing for the psf-slp-indexer in a separate thread. It would do the sorting and filtering pre-process work and then hand the data 
back to psf-slp-indexer. This approach simply didn't scale. psf-slp-indexer still needed to analyze every TX in a block to find uncontrolled burns. So handing off the
pre-processing didn't save much it terms of CPU usage. See [this issue](https://github.com/Permissionless-Software-Foundation/psf-slp-indexer/issues/75) for the new approach.

## Overview

This is a REST API that provides support features to the [psf-slp-indexer](https://github.com/Permissionless-Software-Foundation/psf-slp-indexer).

The inspiration for this app was the observation that SLP tokens would temporarily 'wink' out of existence and then come back after a short period of time during periods of high transaction volume and generation of large blocks. The reason this would happen is because node.js JavaScript is single threaded. Analyzing the new block would reduce the indexers ability to process new SLP transaction in real-time.

[Node.js Worker Threads](https://nodejs.org/api/worker_threads.html) were explored first, but they do not play well with Promises. So this second REST API was created, which creates a new Process. This solves the issue by allowing the processing of SLP indexing to leverage more than one processing core. During real-time processing, the SLP indexer can pass block analysis off to this app, while it continues to processing real-time transactions.

This app will mostly likely be expanded to take on additional intensive processing, in order to support the performance of the SLP indexer.

## Requirements

- node **^16.20.2**
- npm **^8.19.4**
- Docker **^20.10.8**
- Docker Compose **^1.27.4**

## Installation

### Production Environment

The [docker](./production/docker) directory contains a Dockerfile for building a production deployment.

```
docker-compose pull
docker-compose up -d
```

- You can bring the containers down with `docker-compose down`
- You can bring the containers back up with `docker-compose up -d`.

### Development Environment

A development environment will allow you modify the code on-the-fly and contribute to the code base of this repository. Ubuntu v20 is the recommended OS for creating a dev environment. Other operating systems may cause issues.

```bash
git clone https://github.com/Permissionless-Software-Foundation/slp-support-api
cd slp-support-api
./install-mongo-sh
npm install
npm start
```

### Configuration

This app is intended to be started via a bash shell script. See the environment variables used to configure this app in the [config/env/common.js file](./config/env/common.js).

## File Structure

The file layout of this repository follows the file layout of [Clean Architecture](https://christroutner.github.io/trouts-blog/blog/clean-architecture). Understaning the principles laid out this article will help developers navigate the code base.

## Usage

- `npm start` Start server on live mode
- `npm run docs` Generate API documentation
- `npm test` Run mocha tests

## Documentation

API documentation is written inline and generated by [apidoc](http://apidocjs.com/). Docs can be generated with this command:
- `npm run docs`

Visit `http://localhost:5020/` to view docs

There is additional developer documentation in the [dev-docs directory](./dev-docs).

## Dependencies

- [koa2](https://github.com/koajs/koa/tree/v2.x)
- [koa-router](https://github.com/alexmingoia/koa-router)
- [koa-bodyparser](https://github.com/koajs/bodyparser)
- [koa-generic-session](https://github.com/koajs/generic-session)
- [koa-logger](https://github.com/koajs/logger)
- [MongoDB](http://mongodb.org/)
- [Mongoose](http://mongoosejs.com/)
- [Passport](http://passportjs.org/)
- [Nodemon](http://nodemon.io/)
- [Mocha](https://mochajs.org/)
- [apidoc](http://apidocjs.com/)
- [ESLint](http://eslint.org/)
- [ipfs-coord](https://www.npmjs.com/package/ipfs-coord)

## IPFS

Snapshots pinned to IPFS will be listed here.

## License

[MIT](./LICENSE.md)
